{% extends 'tienda/base.html' %}
{% load static %}

{% block title %}Carrito de Compras - Chispitas{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden animate-slide-in">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-pink-500 to-purple-500 p-6 text-white">
            <h2 class="text-3xl font-bold flex items-center gap-3">
                üõí Tu Carrito
            </h2>
        </div>

        <div class="p-6">
            {% if items %}
            
            <!-- Items -->
            <div class="space-y-4 mb-6">
                {% for item in items %}
                <div class="flex items-center gap-4 p-4 bg-purple-50 rounded-xl border-2 border-purple-100">

                    <!-- Imagen -->
                    <div class="w-16 h-16 rounded-xl overflow-hidden bg-white border border-purple-200 flex items-center justify-center">
                        {% if item.imagen %}
                            <img src="{{ item.imagen }}"
                                 alt="{{ item.nombre }}"
                                 class="w-full h-full object-contain">
                        {% else %}
                            <span class="text-3xl">üß∏</span>
                        {% endif %}
                    </div>

                    <!-- Info -->
                    <div class="flex-1">
                        <h4 class="font-bold text-purple-900">
                            {{ item.nombre }}
                        </h4>
                        <p class="text-pink-600 font-semibold">
                            ‚Ç°{{ item.precio|floatformat:0 }}
                        </p>
                    </div>

                    <!-- Cantidad -->
                    <div class="flex items-center gap-3">
                        <form method="POST" action="{% url 'tienda:actualizar_cantidad' item.id %}" class="inline">
                            {% csrf_token %}
                            <input type="hidden" name="accion" value="decrementar">
                            <button type="submit"
                                    class="w-8 h-8 bg-purple-200 hover:bg-purple-300 rounded-full font-bold transition">
                                -
                            </button>
                        </form>

                        <span class="font-bold text-lg w-8 text-center">
                            {{ item.cantidad }}
                        </span>

                        <form method="POST" action="{% url 'tienda:actualizar_cantidad' item.id %}" class="inline">
                            {% csrf_token %}
                            <input type="hidden" name="accion" value="incrementar">
                            <button type="submit"
                                    class="w-8 h-8 bg-purple-200 hover:bg-purple-300 rounded-full font-bold transition"
                                    {% if item.cantidad >= item.stock %}disabled{% endif %}>
                                +
                            </button>
                        </form>

                        <a href="{% url 'tienda:eliminar_del_carrito' item.id %}"
                           class="ml-2 text-red-500 hover:text-red-700 transition">
                            ‚ùå
                        </a>
                    </div>

                    <!-- Subtotal -->
                    <div class="text-right">
                        <p class="text-sm text-gray-600">Subtotal:</p>
                        <p class="font-bold text-lg text-purple-900">
                            ‚Ç°{{ item.subtotal|floatformat:0 }}
                        </p>
                    </div>

                </div>
                {% endfor %}
            </div>

            <!-- Total -->
            <div class="border-t-2 border-purple-100 pt-6 bg-purple-50 p-6 rounded-xl">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-xl font-bold text-purple-900">
                        Total:
                    </span>
                    <span class="text-3xl font-bold text-pink-600">
                        ‚Ç°{{ total|floatformat:0 }}
                    </span>
                </div>

                <div class="flex gap-3">
                    <a href="{% url 'tienda:index' %}"
                       class="flex-1 text-center bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-xl font-bold transition">
                        ‚Üê Seguir Comprando
                    </a>

                    <a href="{% url 'tienda:checkout' %}"
                       class="flex-1 text-center btn-primary text-white py-3 rounded-xl font-bold shadow-lg">
                        Proceder al Pago üí≥
                    </a>
                </div>

                <a href="{% url 'tienda:vaciar_carrito' %}"
                   class="block text-center mt-3 text-red-600 hover:text-red-700 text-sm">
                    Vaciar carrito
                </a>
            </div>

            {% else %}

            <!-- Carrito vac√≠o -->
            <div class="text-center py-12">
                <p class="text-2xl text-gray-400 mb-4">
                    Tu carrito est√° vac√≠o üõí
                </p>
                <p class="text-sm text-gray-500 mb-6">
                    ¬°Agrega productos para comenzar!
                </p>

                <a href="{% url 'tienda:index' %}"
                   class="inline-block btn-primary text-white px-8 py-3 rounded-xl font-bold shadow-lg">
                    Ver Productos üõçÔ∏è
                </a>
            </div>

            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
